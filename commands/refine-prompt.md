---
name: refine-prompt
description: Simple and fast prompt refinement tool that transforms brief user inputs into detailed, actionable instructions with automatic project-specific workflow requirements. Automatically saves results to refined-prompt/ directory.
allowed-tools: Read, Write, Bash
argument-hint: "<brief_prompt>" (the prompt you want to refine and enhance)
---

Transform your brief prompts into comprehensive, project-aware instructions with automatic workflow requirements. **Results are automatically saved to `refined-prompt/` directory for future reference.**

**IMPORTANT: This command generates and displays refined prompts for you to copy and use - it does NOT execute the prompts.**

## Command Usage

```bash
# Comprehensive prompt refinement with workflow requirements
/refine-prompt "Add user authentication"
# → Returns technical requirements + project workflow reminders
# → Saves to refined-prompt/YYYY-MM-DD_HHMMSS.md

# Bug fixing with complete workflow
/refine-prompt "Fix login issue"
# → Returns debugging steps + testing and documentation requirements
# → Saves to refined-prompt/YYYY-MM-DD_HHMMSS.md

# Feature development with full context
/refine-prompt "Build shopping cart"
# → Returns implementation details + development workflow requirements
# → Saves to refined-prompt/YYYY-MM-DD_HHMMSS.md
```

## Comprehensive Enhancement Process

### Step 1: Technical Refinement
- **Analyze** your brief input for intent and scope
- **Expand** with specific technical details and actionable steps  
- **Clarify** requirements, constraints, and expected outcomes
- **Format** as detailed, actionable instructions

### Step 2: Workflow Integration
- **Read** PROMPT_SCENARIOS.md for project-specific workflows
- **Detect** matching scenarios based on keywords in refined prompt
- **Append** relevant workflow requirements as additional sections
- **Integrate** seamlessly with technical requirements

### Step 3: File Output
- **Create Directory**: Ensure `refined-prompt/` directory exists in project root
- **Generate Filename**: Create timestamped filename
- **Save Content**: Write both original and refined prompts to markdown file
- **Display Location**: Show user where the file was saved

## Automatic File Saving

Every refined prompt is automatically saved to `refined-prompt/` directory with the following format:

### File Naming Convention
- **Format**: `YYYY-MM-DD_HHMMSS.md`
- **Example**: `2024-01-15_143027.md`

### File Structure
```markdown
# Prompt Refinement Session

**Generated**: 2024-01-15 14:30:27
**Mode**: Enhanced (with workflow requirements)
**Original Length**: 25 characters
**Refined Length**: 1,247 characters

## 📝 Original Prompt

Add user authentication

## 🔄 Refined Prompt

[Full refined prompt content here]

---
*Generated by /refine-prompt command*
```

### Directory Management
- Creates `refined-prompt/` directory if it doesn't exist
- Organizes all refinement history in one location
- Easy to browse, search, and reuse previous refinements

## Output Format

The command produces comprehensive, project-aware prompts:

```markdown
# 🚀 Enhanced Prompt (Ready to Copy)

## 📋 Technical Requirements
[Detailed technical requirements and implementation steps]

## ⚠️ Project Workflow Requirements
Based on detected scenarios: [Scenario Names]

### 🎯 Feature Development
- 开发前更新需求文档和设计文档
- 开发完成后编写单元测试和集成测试

### 🎯 API Changes
- 更新API文档和接口规范
- 进行API集成测试和契约测试

---
## 📋 How to Use
1. Review both technical and workflow requirements
2. Copy the entire enhanced prompt if it looks good
3. Use it in your next Claude Code session  
4. Modify any parts that don't fit your needs

## 📁 Saved to File
✅ Enhanced prompt saved to: refined-prompt/2024-01-15_143027.md
```

## Scenario Detection

The system automatically detects relevant scenarios by matching keywords:

**Example Keywords:**
- **Feature Development**: implement, add, create, build, develop, new, feature
- **Bug Fixing**: fix, bug, issue, problem, error, debug
- **API Changes**: api, endpoint, route, rest, interface  
- **Database Changes**: database, schema, migration, table, column
- **Testing**: test, testing, unit, integration, e2e

## PROMPT_SCENARIOS.md Integration

**If PROMPT_SCENARIOS.md exists:**
- Reads your custom project scenarios and requirements
- Matches scenarios based on your defined trigger keywords
- Adds your specific workflow requirements

**If PROMPT_SCENARIOS.md doesn't exist:**
- Uses built-in basic scenarios
- Still provides common workflow reminders
- Suggests creating PROMPT_SCENARIOS.md for customization

## Benefits

- **Fast Generation**: Lightweight, proven prompt refinement
- **Complete Workflow**: Technical details + project requirements integrated
- **Never Forget**: Automatic workflow reminders for every refinement
- **Project Aware**: Customizable scenarios via PROMPT_SCENARIOS.md
- **Team Consistency**: Standardized workflow enforcement
- **History Tracking**: All refinements saved to refined-prompt/ directory
- **Organized Archive**: Complete refinement history in one location
- **Easy Reference**: Timestamped files for easy browsing
- **Reusable Content**: Copy from previous refinements
- **Version Control Friendly**: Markdown files work well with git
- **Search Friendly**: Easy to grep through refinement history

## Implementation Details

### Directory Creation Process
1. Check if `refined-prompt/` directory exists in project root
2. Create directory if it doesn't exist using `mkdir -p refined-prompt`
3. Generate timestamp-based filename
4. Write content to file using Write tool

### File Content Format
- **Header**: Metadata about the refinement session
- **Original Prompt**: User's input for reference
- **Refined Prompt**: Full enhanced output with workflow requirements
- **Footer**: Generation timestamp and tool attribution

This comprehensive enhancement approach provides both detailed technical requirements and project-aware workflow reminders, with automatic archiving for future reference.