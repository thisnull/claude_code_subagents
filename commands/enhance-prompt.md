---
name: enhance-prompt
description: Intelligently enhance and refine user prompts by adding detailed clarification and project-specific invisible requirements. Automatically invokes prompt-enhancer subagent to transform brief user inputs into comprehensive, context-aware instructions that include relevant workflow requirements from PROMPT_SCENARIOS.md.
allowed-tools: Task, Read
argument-hint: "<user_prompt>" (the prompt you want to enhance and refine)
---

Transform your brief prompts into comprehensive, project-aware instructions using the specialized `prompt-enhancer` subagent with intelligent scenario matching capabilities.

## Command Usage

```bash
# Enhance a basic prompt
/enhance-prompt "Add user authentication"

# Enhance a bug fixing request
/enhance-prompt "Fix the login issue"

# Enhance a database change request  
/enhance-prompt "Update user table schema"

# Enhance a deployment request
/enhance-prompt "Deploy the new API version"
```

## Two-Step Enhancement Process

### Step 1: Prompt Clarification
The system transforms vague inputs into detailed, actionable instructions:

**Example Transformation:**
```
Input: "Add user authentication"
↓ 
Enhanced: "Implement comprehensive user authentication system including:
- JWT token-based authentication with refresh token support
- Secure login/logout endpoints with proper validation
- Password hashing using bcrypt with salt
- Session management middleware for protected routes
- Error handling for invalid credentials and expired tokens
- Integration with existing user data model
- Unit tests for auth functions and integration tests for auth flows
- API documentation for authentication endpoints"
```

### Step 2: Invisible Requirements Integration
Automatically detects scenarios and appends project-specific requirements:

**Scenario Detection Examples:**
- **"Add user authentication"** → Detects: Feature Development
- **"Fix login bug"** → Detects: Bug Fixing  
- **"Update database schema"** → Detects: Database Schema Changes
- **"Deploy to production"** → Detects: Deployment

**Invisible Requirements Added:**
```markdown
## ⚠️ Special Project Requirements
### 🎯 Feature Development
- 开发前更新需求文档和设计文档
- 实现过程中遵循项目编码规范
- 开发完成后编写对应的单元测试和集成测试
- 更新API文档（如涉及接口变更）

### 🎯 Database Schema Changes  
- 修改数据库schema前必须阅读docs/database-migration-guide.md
- 创建向后兼容的数据库迁移脚本
- 在测试环境验证迁移脚本
```

## PROMPT_SCENARIOS.md Configuration

The command reads project-specific scenarios from `PROMPT_SCENARIOS.md` in the project root.

### Initial Setup
If `PROMPT_SCENARIOS.md` doesn't exist, the command will create a template with common scenarios:

```markdown
# Project Prompt Scenarios

## Feature Development
**Triggers**: implement, add, create, build, develop, new feature
**Invisible Requirements**:
- 开发前更新需求文档和设计文档
- 实现过程中遵循项目编码规范
- 开发完成后编写对应的单元测试和集成测试

## Bug Fixing
**Triggers**: fix, bug, issue, problem, error, debug
**Invisible Requirements**:
- 修改完成后必须进行测试验证
- 测试通过后，将调试过程和解决方案记录到troubleshooting文档

## Database Schema Changes
**Triggers**: database, schema, migration, table, column
**Invisible Requirements**:
- 修改数据库schema前必须阅读相关迁移文档
- 创建向后兼容的数据库迁移脚本
- 在测试环境验证迁移脚本
```

### Customization
You can customize scenarios by editing `PROMPT_SCENARIOS.md`:
- Add new scenarios for your specific workflows
- Modify trigger keywords to match your terminology
- Update invisible requirements to reflect your team's practices
- Include references to your specific documentation and tools

## Enhanced Output Format

The command produces a comprehensive, formatted prompt ready for use:

```markdown
# Enhanced Prompt

## 📋 Detailed Requirements
[Clarified and expanded prompt with specific actionable steps]

## ⚠️ Special Project Requirements  
Based on detected scenarios: [Feature Development, Testing]

### 🎯 Feature Development
- 开发前更新需求文档和设计文档
- 实现过程中遵循项目编码规范
- 开发完成后编写对应的单元测试和集成测试

### 🎯 Testing
- 确保测试覆盖率达到项目标准
- 运行完整的回归测试套件
- 验证功能在不同环境中的表现

---
*Auto-generated by prompt-enhancer*
```

## Execution Flow

```
When user executes /enhance-prompt "<user_prompt>":
→ Automatically invokes prompt-enhancer subagent
→ Agent analyzes and refines the user's prompt  
→ Agent reads PROMPT_SCENARIOS.md for scenario definitions
→ Agent detects matching scenarios using keyword analysis
→ Agent integrates relevant invisible requirements
→ Agent formats and returns the enhanced prompt
→ User receives comprehensive, project-aware instructions
```

## Intelligent Features

### Scenario Detection Intelligence
- **Keyword Matching**: Scans prompt for trigger words from each scenario
- **Context Analysis**: Understands workflow context and project structure
- **Relevance Scoring**: Ranks scenarios by relevance (60%+ threshold)
- **Smart Filtering**: Avoids duplicate or conflicting requirements

### Project Awareness
- **File Structure**: Considers existing project directories and conventions  
- **Technology Stack**: Adapts requirements based on detected technologies
- **Documentation Integration**: References existing project documentation
- **Workflow Integration**: Aligns with established development practices

## Benefits

### For Individual Development
- **Never Forget Requirements**: Automatically reminds of important workflow steps
- **Consistent Quality**: Ensures all prompts include necessary quality checks
- **Project Integration**: Connects tasks to existing documentation and practices
- **Time Saving**: Eliminates need to remember and manually add workflow requirements

### for Team Collaboration  
- **Standardized Workflows**: Ensures all team members follow established practices
- **Knowledge Preservation**: Captures institutional knowledge in reusable format
- **Onboarding Support**: New team members automatically learn project requirements
- **Process Enforcement**: Built-in reminders for critical workflow steps

## Usage Examples

```bash
# Feature development with automatic testing reminders
/enhance-prompt "Add shopping cart functionality"

# Bug fixing with debugging and documentation requirements
/enhance-prompt "Fix the checkout payment error" 

# Database changes with migration safety requirements
/enhance-prompt "Add indexes to user table for performance"

# API changes with documentation update requirements  
/enhance-prompt "Update user profile API endpoints"
```

This command transforms brief ideas into comprehensive, project-aware development instructions that include both technical clarity and workflow best practices.