---
name: enhance-prompt
description: Intelligently enhance and refine user prompts by adding detailed clarification and project-specific invisible requirements. Automatically invokes prompt-enhancer subagent to transform brief user inputs into comprehensive, context-aware instructions that include relevant workflow requirements from PROMPT_SCENARIOS.md.
allowed-tools: Task, Read
argument-hint: "<user_prompt>" (the prompt you want to enhance and refine)
---

Transform your brief prompts into comprehensive, project-aware instructions using the specialized `prompt-enhancer` subagent with intelligent scenario matching capabilities.

## Command Usage

```bash
# Enhance a basic prompt
/enhance-prompt "Add user authentication"

# Enhance a bug fixing request
/enhance-prompt "Fix the login issue"

# Enhance a database change request  
/enhance-prompt "Update user table schema"

# Enhance a deployment request
/enhance-prompt "Deploy the new API version"
```

## Two-Step Enhancement Process

### Step 1: Prompt Clarification
The system transforms vague inputs into detailed, actionable instructions:

**Example Transformation:**
```
Input: "Add user authentication"
â†“ 
Enhanced: "Implement comprehensive user authentication system including:
- JWT token-based authentication with refresh token support
- Secure login/logout endpoints with proper validation
- Password hashing using bcrypt with salt
- Session management middleware for protected routes
- Error handling for invalid credentials and expired tokens
- Integration with existing user data model
- Unit tests for auth functions and integration tests for auth flows
- API documentation for authentication endpoints"
```

### Step 2: Invisible Requirements Integration
Automatically detects scenarios and appends project-specific requirements:

**Scenario Detection Examples:**
- **"Add user authentication"** â†’ Detects: Feature Development
- **"Fix login bug"** â†’ Detects: Bug Fixing  
- **"Update database schema"** â†’ Detects: Database Schema Changes
- **"Deploy to production"** â†’ Detects: Deployment

**Invisible Requirements Added:**
```markdown
## âš ï¸ Special Project Requirements
### ğŸ¯ Feature Development
- å¼€å‘å‰æ›´æ–°éœ€æ±‚æ–‡æ¡£å’Œè®¾è®¡æ–‡æ¡£
- å®ç°è¿‡ç¨‹ä¸­éµå¾ªé¡¹ç›®ç¼–ç è§„èŒƒ
- å¼€å‘å®Œæˆåç¼–å†™å¯¹åº”çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- æ›´æ–°APIæ–‡æ¡£ï¼ˆå¦‚æ¶‰åŠæ¥å£å˜æ›´ï¼‰

### ğŸ¯ Database Schema Changes  
- ä¿®æ”¹æ•°æ®åº“schemaå‰å¿…é¡»é˜…è¯»docs/database-migration-guide.md
- åˆ›å»ºå‘åå…¼å®¹çš„æ•°æ®åº“è¿ç§»è„šæœ¬
- åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è¿ç§»è„šæœ¬
```

## PROMPT_SCENARIOS.md Configuration

The command reads project-specific scenarios from `PROMPT_SCENARIOS.md` in the project root.

### Initial Setup
If `PROMPT_SCENARIOS.md` doesn't exist, the command will create a template with common scenarios:

```markdown
# Project Prompt Scenarios

## Feature Development
**Triggers**: implement, add, create, build, develop, new feature
**Invisible Requirements**:
- å¼€å‘å‰æ›´æ–°éœ€æ±‚æ–‡æ¡£å’Œè®¾è®¡æ–‡æ¡£
- å®ç°è¿‡ç¨‹ä¸­éµå¾ªé¡¹ç›®ç¼–ç è§„èŒƒ
- å¼€å‘å®Œæˆåç¼–å†™å¯¹åº”çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

## Bug Fixing
**Triggers**: fix, bug, issue, problem, error, debug
**Invisible Requirements**:
- ä¿®æ”¹å®Œæˆåå¿…é¡»è¿›è¡Œæµ‹è¯•éªŒè¯
- æµ‹è¯•é€šè¿‡åï¼Œå°†è°ƒè¯•è¿‡ç¨‹å’Œè§£å†³æ–¹æ¡ˆè®°å½•åˆ°troubleshootingæ–‡æ¡£

## Database Schema Changes
**Triggers**: database, schema, migration, table, column
**Invisible Requirements**:
- ä¿®æ”¹æ•°æ®åº“schemaå‰å¿…é¡»é˜…è¯»ç›¸å…³è¿ç§»æ–‡æ¡£
- åˆ›å»ºå‘åå…¼å®¹çš„æ•°æ®åº“è¿ç§»è„šæœ¬
- åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è¿ç§»è„šæœ¬
```

### Customization
You can customize scenarios by editing `PROMPT_SCENARIOS.md`:
- Add new scenarios for your specific workflows
- Modify trigger keywords to match your terminology
- Update invisible requirements to reflect your team's practices
- Include references to your specific documentation and tools

## Enhanced Output Format

The command produces a comprehensive, formatted prompt ready for use:

```markdown
# Enhanced Prompt

## ğŸ“‹ Detailed Requirements
[Clarified and expanded prompt with specific actionable steps]

## âš ï¸ Special Project Requirements  
Based on detected scenarios: [Feature Development, Testing]

### ğŸ¯ Feature Development
- å¼€å‘å‰æ›´æ–°éœ€æ±‚æ–‡æ¡£å’Œè®¾è®¡æ–‡æ¡£
- å®ç°è¿‡ç¨‹ä¸­éµå¾ªé¡¹ç›®ç¼–ç è§„èŒƒ
- å¼€å‘å®Œæˆåç¼–å†™å¯¹åº”çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### ğŸ¯ Testing
- ç¡®ä¿æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°é¡¹ç›®æ ‡å‡†
- è¿è¡Œå®Œæ•´çš„å›å½’æµ‹è¯•å¥—ä»¶
- éªŒè¯åŠŸèƒ½åœ¨ä¸åŒç¯å¢ƒä¸­çš„è¡¨ç°

---
*Auto-generated by prompt-enhancer*
```

## Execution Flow

```
When user executes /enhance-prompt "<user_prompt>":
â†’ Automatically invokes prompt-enhancer subagent
â†’ Agent analyzes and refines the user's prompt  
â†’ Agent reads PROMPT_SCENARIOS.md for scenario definitions
â†’ Agent detects matching scenarios using keyword analysis
â†’ Agent integrates relevant invisible requirements
â†’ Agent formats and returns the enhanced prompt
â†’ User receives comprehensive, project-aware instructions
```

## Intelligent Features

### Scenario Detection Intelligence
- **Keyword Matching**: Scans prompt for trigger words from each scenario
- **Context Analysis**: Understands workflow context and project structure
- **Relevance Scoring**: Ranks scenarios by relevance (60%+ threshold)
- **Smart Filtering**: Avoids duplicate or conflicting requirements

### Project Awareness
- **File Structure**: Considers existing project directories and conventions  
- **Technology Stack**: Adapts requirements based on detected technologies
- **Documentation Integration**: References existing project documentation
- **Workflow Integration**: Aligns with established development practices

## Benefits

### For Individual Development
- **Never Forget Requirements**: Automatically reminds of important workflow steps
- **Consistent Quality**: Ensures all prompts include necessary quality checks
- **Project Integration**: Connects tasks to existing documentation and practices
- **Time Saving**: Eliminates need to remember and manually add workflow requirements

### for Team Collaboration  
- **Standardized Workflows**: Ensures all team members follow established practices
- **Knowledge Preservation**: Captures institutional knowledge in reusable format
- **Onboarding Support**: New team members automatically learn project requirements
- **Process Enforcement**: Built-in reminders for critical workflow steps

## Usage Examples

```bash
# Feature development with automatic testing reminders
/enhance-prompt "Add shopping cart functionality"

# Bug fixing with debugging and documentation requirements
/enhance-prompt "Fix the checkout payment error" 

# Database changes with migration safety requirements
/enhance-prompt "Add indexes to user table for performance"

# API changes with documentation update requirements  
/enhance-prompt "Update user profile API endpoints"
```

This command transforms brief ideas into comprehensive, project-aware development instructions that include both technical clarity and workflow best practices.